<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Can the Golang Microservice Framework Actually Develop Single Applications? -- GoMicro Monolithic Architecture Practice | DevExps</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://devexps.com/img/social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://devexps.com/img/social-card.jpg"><meta data-rh="true" property="og:url" content="https://devexps.com/2023/12/17/go-micro-monolithic-architechture-practice/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="go, golang, micro-services, flutter"><meta data-rh="true" property="og:title" content="Can the Golang Microservice Framework Actually Develop Single Applications? -- GoMicro Monolithic Architecture Practice | DevExps"><meta data-rh="true" name="description" content="Can the Golang Microservice Framework Actually Develop Single Applications? -- GoMicro Monolithic Architecture Practice"><meta data-rh="true" property="og:description" content="Can the Golang Microservice Framework Actually Develop Single Applications? -- GoMicro Monolithic Architecture Practice"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-12-17T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="go-micro,microservice,framework,swagger,monolithic,architecture,practice"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://devexps.com/2023/12/17/go-micro-monolithic-architechture-practice/"><link data-rh="true" rel="alternate" href="https://devexps.com/2023/12/17/go-micro-monolithic-architechture-practice/" hreflang="en"><link data-rh="true" rel="alternate" href="https://devexps.com/2023/12/17/go-micro-monolithic-architechture-practice/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="DevExps RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="DevExps Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-402EFD4Z7G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-402EFD4Z7G",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.ffe377da.css">
<link rel="preload" href="/assets/js/runtime~main.b7737520.js" as="script">
<link rel="preload" href="/assets/js/main.615d3f2f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Life is always coding &amp; debugging." class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Life is always coding &amp; debugging." class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">DevExps</b></a><a class="navbar__item navbar__link" href="/go-micro/">Go-Micro</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/devexps" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/2023/12/17/go-micro-monolithic-architechture-practice/">Can the Golang Microservice Framework Actually Develop Single Applications? -- GoMicro Monolithic Architecture Practice</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/11/17/go-micro-integrates-and-uses-swagger-ui/">Golang microservice framework (Go-Micro) easily integrates and uses Swagger UI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/09/25/go-micro-on-kubernetes-cluster/">How microservice framework (Go-Micro) runs on Kubernetes cluster</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/09/09/locally-deploy-docker-development-environment/">Locally deploy Docker development environment</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/09/06/go-micro-easily-connects-to-efk-log-system/">Go-Micro easily connects to the EFK log system</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/08/24/go-micro-implements-sse-service/">Golang microservice framework (Go-Micro) implements SSE service</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/05/25/the-interface-and-inheritance-of-golang/">The interface and inheritance of Golang</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2019/09/10/flutter-theme-demo/">Flutter Theme Demo</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2019/09/06/kubernetes-tutorial-for-beginners/">Kubernetes Tutorial for Beginners</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2019/09/04/docker-tutorial-for-beginners/">Docker Tutorial for Beginners</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Can the Golang Microservice Framework Actually Develop Single Applications? -- GoMicro Monolithic Architecture Practice</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-12-17T00:00:00.000Z" itemprop="datePublished">December 17, 2023</time> · <!-- -->18 min read</div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2><p>The microservice framework can also be used to develop applications with a monolith structure. Moreover, a single application is also the smallest, most primitive, and initial project state. After gradual development and evolution, a single application can gradually evolve into a microservice architecture and continuously subdivide service granularity. Since the monolithic architecture application developed by the microservice framework is a minimal implementation, it only needs to use the minimum technology of the microservice framework, which means that it only needs to use the minimum knowledge points of the microservice framework. Take it. It&#x27;s great to learn the microservice framework.</p><p>This article will focus on a demo project I wrote: <a href="https://github.com/devexps/go-monolithic-demo" target="_blank" rel="noopener noreferrer">go-monolithic demo</a> which is both a minimal practice of the microservice framework <a href="https://github.com/devexps/go-micro" target="_blank" rel="noopener noreferrer">go-micro</a> and a complete engineering practice. From it you can learn:</p><ul><li>Use of the build tool <code>Make</code></li><li>Use of dependency injection framework <code>Wire</code></li><li>Use of Protobuf build tool <code>Buf</code></li><li>Use of ORM framework <code>Ent</code></li><li>Application of OpenAPI in project development</li><li>Complete CURD development example</li><li>User login authentication and authorization</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-should-we-learn-to-use-the-microservice-framework">Why should we learn to use the microservice framework?<a href="#why-should-we-learn-to-use-the-microservice-framework" class="hash-link" aria-label="Direct link to Why should we learn to use the microservice framework?" title="Direct link to Why should we learn to use the microservice framework?">​</a></h2><p>I promote microservice architecture to people around me, but I often get a negative attitude, such as:</p><ul><li>I don&#x27;t have that many people online or such a large project scale, so I don&#x27;t need microservices.</li><li>I can use GIN to put it out. What microservice framework should I use? </li><li>The microservices framework is too complex to learn.</li><li>...</li></ul><p>To sum it up, it&#x27;s nothing more than:</p><ul><li>The knowledge of the microservices is too broad, it is difficult to get started, and the learning curve is too steep.</li><li>For small and medium-sized projects, the microservice framework is not needed.</li></ul><p>Indeed, microservices require a lot of knowledge: service governance (service registration and discovery), load balancing, service circuit breaker, service degradation, service current limiting, service fault tolerance, service gateway, distributed configuration, link tracking, service performance monitoring, RPC service calling,...</p><p>With so many knowledge points, it&#x27;s indeed not easy to get started. For many small and medium-sized enterprises, their project scale is small, and most of the projects are CURD projects. For such projects, developers only need to know how to write HTTP routing and how to write ORM, and that&#x27;s it. Even most of the code can be generated through a code generator. To find so many talents, it is difficult to recruit one person. The capital of a company is also limited. It needs to control costs and cannot afford to hire.</p><p>Then, the current situation seems obvious: small and medium-sized enterprises and small and medium-sized projects do not seem to need microservices.</p><p>However, the microservice framework is not used, is it not necessary?</p><p>The answer is <strong>negative</strong>.</p><p>In actual project development, I have developed several monolithic applications using the microservice framework Go-Micro and put them into operation online. In the smallest project, I just used: REST service and ORM to access the database. There are not many knowledge points involved, so it is not too complicated to develop.</p><p>So, someone will definitely ask me: what&#x27;s the point of using a microservices framework?</p><p>My considerations are as follows:</p><ul><li>Small projects are not all we have. We also have medium and large projects. It is always better for a company to use one technology stack than multiple technology stacks.</li><li>Go-Micro is better at engineering and standardizes the company&#x27;s development.</li><li>Go-Micro defines protocols based on Protobuf, and gRPC communicates between services. It has strong practical value in the company&#x27;s diverse development scenario.</li><li>Go-Micro is developed based on the plug-in mechanism and is extremely easy to extend.</li></ul><p>In summary, these are my reasons. When making a technical selection, I compared almost all frameworks on the market horizontally, and finally, I chose Go-Micro (It&#x27;s also mine).</p><p>Another point is that the development process of microservices is not one-step process. The development of microservices is gradual as the saying goes: one is born with two, two is born with three, three is born with all things. Starting from a single application and gradually spliting it services is not an unusual thing either.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="demo-code-repository">Demo code repository<a href="#demo-code-repository" class="hash-link" aria-label="Direct link to Demo code repository" title="Direct link to Demo code repository">​</a></h2><p>The code comes first, which is suitable for students who don&#x27;t like to verbose words.</p><p><a href="https://github.com/devexps/go-monolithic-demo" target="_blank" rel="noopener noreferrer">https://github.com/devexps/go-monolithic-demo</a></p><p>For those students who want to learn to use the microservice framework, this single project developed by the microservice framework is essentially minimal, so it is also a very suitable project for learning.</p><p>For me, it is an experimental field for engineering experiments. I mainly use it to experiment with several basic forms of software engineering:</p><ol><li>Standardization</li><li>Modularity</li><li>Processization</li><li>Practical and instrumental</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="project-structure">Project structure<a href="#project-structure" class="hash-link" aria-label="Direct link to Project structure" title="Direct link to Project structure">​</a></h2><p>This project includes front-end and back-end code. Then front-end is a Vue3 + Typescript Admin. However, the front-end is not the focus of this article. This article focuses on the back-end.</p><p>The front-end project is in the <code>frontend</code> folder, and the back-end project is in the <code>backend</code> folder.</p><p>Backend project structure:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── api </span><span class="token comment" style="color:#999988;font-style:italic"># The path where the proto protocol is stored</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    ├── admin </span><span class="token comment" style="color:#999988;font-style:italic"># Admin service defines the REST interface.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │    └── </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │        └── v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    ├── common </span><span class="token comment" style="color:#999988;font-style:italic"># Common service defines such as pagination, routing, etc.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │    └── pagination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    ├── user </span><span class="token comment" style="color:#999988;font-style:italic"># User service defines users info.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │    └── </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │        └── v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    └── user_token </span><span class="token comment" style="color:#999988;font-style:italic"># UserToken service defines user&#x27;s token info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│        └── </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            └── v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── app </span><span class="token comment" style="color:#999988;font-style:italic"># The path where the application is located.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    └── admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│        └── </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            ├── cmd </span><span class="token comment" style="color:#999988;font-style:italic"># Entry of the application.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            │    └── server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            │        └── assets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            ├── configs </span><span class="token comment" style="color:#999988;font-style:italic"># Application configuration files.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            └── internal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                ├── data </span><span class="token comment" style="color:#999988;font-style:italic"># Application data layer, logical code for database operations.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                │    └── ent </span><span class="token comment" style="color:#999988;font-style:italic"># Use Facebook&#x27;s ORM, entgo.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                │        └── schema </span><span class="token comment" style="color:#999988;font-style:italic"># Database struct definition.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                ├── server </span><span class="token comment" style="color:#999988;font-style:italic"># The transport layer of the application, the input and output points provided by the application (REST, gRPC, Kafka, etc.)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                └── </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Application service layer, processor code for REST, gRPC, Kafka, etc.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── gen </span><span class="token comment" style="color:#999988;font-style:italic"># Go code storage path generated by proto protocol.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    └── api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│        └── go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            ├── admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            │    └── </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            │        └── v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            ├── common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            │    └── pagination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            ├── user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            │    └── </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            │        └── v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            └── user_token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                └── </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    └── v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pkg </span><span class="token comment" style="color:#999988;font-style:italic"># Public code storage path.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    ├── middleware</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │    └── auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    └── </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── sql </span><span class="token comment" style="color:#999988;font-style:italic"># Storage path for some SQL queries.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisite-knowledge">Prerequisite knowledge<a href="#prerequisite-knowledge" class="hash-link" aria-label="Direct link to Prerequisite knowledge" title="Direct link to Prerequisite knowledge">​</a></h2><ul><li><a href="https://github.com/google/wire" target="_blank" rel="noopener noreferrer">Wire</a></li><li><a href="https://protobuf.dev/" target="_blank" rel="noopener noreferrer">Protocol Buffers</a></li><li><a href="https://grpc.io/" target="_blank" rel="noopener noreferrer">gRPC</a></li><li><a href="https://grpc-ecosystem.github.io/grpc-gateway/" target="_blank" rel="noopener noreferrer">gRPC-Gateway</a></li><li><a href="https://entgo.io/" target="_blank" rel="noopener noreferrer">Entgo</a></li><li><a href="https://buf.build/" target="_blank" rel="noopener noreferrer">Buf</a></li><li><a href="https://makefiletutorial.com/" target="_blank" rel="noopener noreferrer">Makefile</a></li><li><a href="https://swagger.io/specification/" target="_blank" rel="noopener noreferrer">OpenAPI</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation-environment">Installation environment<a href="#installation-environment" class="hash-link" aria-label="Direct link to Installation environment" title="Direct link to Installation environment">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-make">Install Make<a href="#install-make" class="hash-link" aria-label="Direct link to Install Make" title="Direct link to Install Make">​</a></h3><p>Linux and Mac are basically pre-installed. Even if they are not pre-installed, the installation is very simple, so I won&#x27;t go into details. Mainly, it is troublesome under Windows, you can find some articles about it like <code>How to use Make to compile Golang programs under Windows</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="protoc-installation">Protoc installation<a href="#protoc-installation" class="hash-link" aria-label="Direct link to Protoc installation" title="Direct link to Protoc installation">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="on-macos">On macOS<a href="#on-macos" class="hash-link" aria-label="Direct link to On macOS" title="Direct link to On macOS">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> protobuf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="on-ubuntu">On Ubuntu<a href="#on-ubuntu" class="hash-link" aria-label="Direct link to On Ubuntu" title="Direct link to On Ubuntu">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> update</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> upgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> libprotobuf-dev protobuf-compiler</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="golang-install-tools">Golang install tools<a href="#golang-install-tools" class="hash-link" aria-label="Direct link to Golang install tools" title="Direct link to Golang install tools">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">go </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> github.com/devexps/go-micro/cmd/micro/v2@latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> github.com/devexps/go-micro/cmd/protoc-gen-go-http/v2@latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> github.com/devexps/go-micro/cmd/protoc-gen-go-errors/v2@latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> google.golang.org/protobuf/cmd/protoc-gen-go@latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> github.com/envoyproxy/protoc-gen-validate@latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> github.com/google/gnostic/cmd/protoc-gen-openapi@latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> github.com/google/wire/cmd/wire@latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> github.com/golangci/golangci-lint/cmd/golangci-lint@latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> github.com/bufbuild/buf/cmd/buf@latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or execute it in the <code>backend</code> project root directory:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">make</span><span class="token plain"> init</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-ide-plug-in">Install IDE plug-in<a href="#install-ide-plug-in" class="hash-link" aria-label="Direct link to Install IDE plug-in" title="Direct link to Install IDE plug-in">​</a></h3><p>In the IDE (VSC and GoLand), the remote proto source code library will be pulled into the local cache folder, and the IDE does not know it, so it cannot parse the dependent proto files. However, <code>Buf</code> officially provides a plug-in, can help the IDE read and parse proto files, and comes with <code>Lint</code>.</p><ul><li>Buf plug-in for VSC: <a href="https://marketplace.visualstudio.com/items?itemName=bufbuild.vscode-buf" target="_blank" rel="noopener noreferrer">https://marketplace.visualstudio.com/items?itemName=bufbuild.vscode-buf</a></li><li>Buf plugin for GoLand: <a href="https://plugins.jetbrains.com/plugin/19147-buf-for-protocol-buffers" target="_blank" rel="noopener noreferrer">https://plugins.jetbrains.com/plugin/19147-buf-for-protocol-buffers</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="use-of-wire">Use of Wire<a href="#use-of-wire" class="hash-link" aria-label="Direct link to Use of Wire" title="Direct link to Use of Wire">​</a></h2><p><code>Wire</code> is a dependency injection framework open source by Google. The role of dependency injection is:</p><ul><li>Create objects</li><li>Know which classes require which objects</li><li>And provide all these objects</li></ul><p>First, there is one under the <code>server</code>, <code>service</code>, and <code>data</code> packages:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> ProviderSet </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> wire</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewSet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>NewSet</code> method contains all object creation methods.</p><p>There are two code files for wire: <code>wire.go</code> and <code>wire_gen.go</code>, which are stored in the same folder as <code>main.go</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="wirego">wire.go<a href="#wirego" class="hash-link" aria-label="Direct link to wire.go" title="Direct link to wire.go">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//go:build wireinject</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// +build wireinject</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// The build tag makes sure the stub is not built in the final build.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/google/wire&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-micro/v2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-micro/v2/log&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-micro/v2/registry&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conf </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-bootstrap/gen/api/go/conf/v1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-monolithic-demo/app/admin/service/internal/data&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-monolithic-demo/app/admin/service/internal/server&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-monolithic-demo/app/admin/service/internal/service&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// initApp init GoMicro application.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initApp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Logger</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> registry</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Registrar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Bootstrap</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">micro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">App</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">panic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wire</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProviderSet</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProviderSet</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProviderSet</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newApp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This file does not participate in compilation. It is a template provided to the code generator. It introduces the dependencies in the <code>ProvideSet</code> and is assembled by the code generator.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="wire_gengo">wire_gen.go<a href="#wire_gengo" class="hash-link" aria-label="Direct link to wire_gen.go" title="Direct link to wire_gen.go">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Code generated by Wire. DO NOT EDIT.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//go:generate go run github.com/google/wire/cmd/wire</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//go:build !wireinject</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// +build !wireinject</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-bootstrap/gen/api/go/conf/v1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-micro/v2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-micro/v2/log&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-micro/v2/registry&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-monolithic-demo/app/admin/service/internal/data&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-monolithic-demo/app/admin/service/internal/server&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-monolithic-demo/app/admin/service/internal/service&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Injectors from wire.go:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// initApp init GoMicro application.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initApp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logger log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Logger</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> registrar registry</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Registrar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bootstrap </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">v1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Bootstrap</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">micro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">App</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authenticator </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewAuthenticator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bootstrap</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authorizer </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewAuthorizer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entClient </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewEntClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bootstrap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> logger</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewRedisClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bootstrap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> logger</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cleanup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> entClient</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> authenticator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> authorizer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userRepo </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewUserRepo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dataData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> logger</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userTokenRepo </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewUserTokenRepo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dataData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> logger</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authenticationService </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewAuthenticationService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> userRepo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> userTokenRepo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userService </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewUserService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> userRepo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    httpServer </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewHTTPServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bootstrap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> logger</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> authenticator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> authorizer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> authenticationService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> userService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">newApp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> registrar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> httpServer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> app</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">cleanup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This file is generated by Wire&#x27;s code generator. It can be seen from the code that the complex dependency calling relationship is easily sorted out by Wire.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="code-generation">Code generation<a href="#code-generation" class="hash-link" aria-label="Direct link to Code generation" title="Direct link to Code generation">​</a></h3><p>There are two ways to generate Wire code, one is to install the wire executable program, and the other is to use <code>go run</code> to compile and execute dynamically.
Dynamic compilation and execution are recommended. Why? This ensures that the version of the code generator is consistent with the version of Wire in the project.
If the versions are inconsistent, some problem may occur.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">go run -mod</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mod github.com/google/wire/cmd/wire ./cmd/server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>I have written this command into <code>app.mk</code>, which can be executed under the <code>app/admin/service</code> path:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">make</span><span class="token plain"> wire</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="use-of-buf">Use of Buf<a href="#use-of-buf" class="hash-link" aria-label="Direct link to Use of Buf" title="Direct link to Use of Buf">​</a></h2><p><a href="https://docs.buf.build/" target="_blank" rel="noopener noreferrer">buf.build</a> is a tool specifically used to build the protobuf API.</p><p>Buf is essentially a tool for calling <code>protoc</code>. It can configure various parameters for calling <code>protoc</code>, and supports remote proto and remote plug-ins.
Therefore, Buf can engineer proto compilation.</p><p>It has a total of 3 sets of configuration files: <code>buf.work.yaml</code>, <code>buf.gen.yaml</code>, and <code>buf.yaml</code></p><p>In addition, there is a <code>buf.lock</code> file, but it does not require manual configuration. It is generated by the <code>buf mod update</code> command. This is similar to the lock files of <code>npm</code>, <code>yarn</code>, etc. on the front end, and the <code>go.sum</code> of Golang is similar.</p><p>It has few configuration files and is not complicated. It is very convenient to maintain. It supports remote proto plugin-ins and remote third-party protos, and it also has good support for the CI/CD system.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bufworkyaml">buf.work.yaml<a href="#bufworkyaml" class="hash-link" aria-label="Direct link to buf.work.yaml" title="Direct link to buf.work.yaml">​</a></h3><p>It is generally placed under the root directory of the project. It represents a workspace, and usually, there is only one configuration file for a project.</p><p>The most important thing about this configuration file is the directories configuration item, which lists the directories of modules to be included in the workspace. The directory path must be relative to <code>buf.work.yaml</code>, such as <code>../external</code> is an invalid configuration.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">directories</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> api</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bufgenyaml">buf.gen.yaml<a href="#bufgenyaml" class="hash-link" aria-label="Direct link to buf.gen.yaml" title="Direct link to buf.gen.yaml">​</a></h3><p>It is generally placed under the same directory as <code>buf.work.yaml</code>. It mainly defines some rules and plug-in configurations generated by <code>protoc</code>.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Configure Protoc generation rules</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">managed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">plugins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># generate go struct code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#- plugin: buf.build/protocolbuffers/go</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">out</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gen/api/go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">opt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> paths=source_relative</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># generate grpc service code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#- plugin: buf.build/grpc/go</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> go</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">grpc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">out</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gen/api/go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">opt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> paths=source_relative</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># generate http service code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> go</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">out</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gen/api/go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">opt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> paths=source_relative</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># generate go-micro errors code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> go</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">errors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">out</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gen/api/go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">opt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> paths=source_relative</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bufyaml">buf.yaml<a href="#bufyaml" class="hash-link" aria-label="Direct link to buf.yaml" title="Direct link to buf.yaml">​</a></h3><p>The path where it is placed can be regarded as the path pointed by the <code>--proto-path</code> parameter of <code>protoc</code>, which is a relative path of the import in the proto file.</p><p>It should be noted that this configuration file must be placed in the same level directory of <code>buf.work.yaml</code></p><p>Generally speaking, the content of this configuration file is the following configuration. There is no need to make any modifications. There are not many situations where modifications are needed.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">deps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;buf.build/googleapis/googleapis&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;buf.build/envoyproxy/protoc-gen-validate&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;buf.build/devexps/gomicroapis&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;buf.build/gnostic/gnostic&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;buf.build/gogo/protobuf&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">breaking</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">use</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> FILE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">lint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">use</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> DEFAULT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="api-code-generation">API code generation<a href="#api-code-generation" class="hash-link" aria-label="Direct link to API code generation" title="Direct link to API code generation">​</a></h3><p>We can use the following command for code generation:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">buf generate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or this way:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">make</span><span class="token plain"> api</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="use-of-ent">Use of Ent<a href="#use-of-ent" class="hash-link" aria-label="Direct link to Use of Ent" title="Direct link to Use of Ent">​</a></h2><p>Ent is an excellent ORM framework. Code generation based on templates has less performance loss than using reflection and other methods. Moreover, the use of templates makes it simple and easy to expand the system.</p><p>Not only can it easily query traditional relational databases (MySQL, PostgreSQL, SQLite), but it can also easily perform graph traversal -- commonly used data queries such as menu tree, organization tree,...</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="schema">Schema<a href="#schema" class="hash-link" aria-label="Direct link to Schema" title="Direct link to Schema">​</a></h3><p>Schema is equivalent to a database table. Schema is the starting point for database development.</p><p>Only when Schema is defined, the code generator can generate the Go data structure of the database table and the Go code for related operations. With these generated codes, we can operate the database table through ORM.</p><p>Ent also supports generating interface definitions for gRPC and GraphQL from Schema. It can be said that Ent has opened up the entire development process - the database is handled backward, and the API is handled forward.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-schema">Create a Schema<a href="#create-a-schema" class="hash-link" aria-label="Direct link to Create a Schema" title="Direct link to Create a Schema">​</a></h3><p>There are many ways to create a Schema, this way is using <strong>Ent Init</strong>:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ent init User</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A <code>user.go</code> file will be generated under <code>{current directory}/ent/schema</code>. If there is no folder, one will be created: </p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;entgo.io/ent&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// User holds the schema definition for the User entity.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> User </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Fields of the User.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">User</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Fields</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">ent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Field </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Edges of the User.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">User</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Edges</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">ent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Edge </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mixin-reuse-fields">Mixin reuse fields<a href="#mixin-reuse-fields" class="hash-link" aria-label="Direct link to Mixin reuse fields" title="Direct link to Mixin reuse fields">​</a></h3><p>In particular applications, we often encounter some identical common fields, such as: <code>id</code>, <code>created_at</code>, <code>updated_at</code>, etc.</p><p>So we can only keep copying and pasting? This makes the code both bloated and inelegant.</p><p>Can <code>Entgo</code> allow us to reuse these fields?</p><p>The answer is obviously, no problem.</p><p><code>Mixin</code> is for this purpose.</p><p>OK, we now need to reuse the time-related fields: <code>created_at</code> and <code>updated_at</code>, then we can:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> mixin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;entgo.io/ent&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;entgo.io/ent/schema/field&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;entgo.io/ent/schema/mixin&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> TimeMixin </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mixin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TimeMixin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Fields</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">ent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Field </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">ent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Field</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        field</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;created_at&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">Immutable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">Default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Now</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        field</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;updated_at&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">Default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Now</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">UpdateDefault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Now</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, we can apply it in Schema, such as <code>User</code>, simply we add a <code>Mixin</code> method to it:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">User</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Mixin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">ent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Mixin </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">ent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Mixin</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mixin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">TimeMixin</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Looking at the generated code, the <code>User</code> table already has these two fields.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="generate-ent-code">Generate Ent code<a href="#generate-ent-code" class="hash-link" aria-label="Direct link to Generate Ent code" title="Direct link to Generate Ent code">​</a></h3><p>Execute in the <code>internal/data/ent</code> directory:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">go run -mod</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mod entgo.io/ent/cmd/ent generate </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --feature privacy </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --feature sql/modifier </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --feature entql </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --feature sql/upsert </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ./internal/data/ent/schema</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or use the <code>Make</code> command directly in the <code>app/admin/service</code> path:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">make</span><span class="token plain"> ent</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="openapi-usages">OpenAPI usages<a href="#openapi-usages" class="hash-link" aria-label="Direct link to OpenAPI usages" title="Direct link to OpenAPI usages">​</a></h2><p>In order to do it, you need to do the following things:</p><ol><li>Write <code>Buf</code> configuration to generate OpenAPI documents.</li><li>Write the command for <code>Buf</code> to generate OpenAPI documents in to <code>Makefile</code>.</li><li>Use Golang&#x27;s Embedding Files feature to embed <code>openapi.yaml</code> in to the program.</li><li>Integrate <code>Swagger UI</code> into the project and read the embedded <code>openapi.yml</code> document.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-write-buf-configuration-to-generate-openapi-documents">1. Write Buf configuration to generate OpenAPI documents<a href="#1-write-buf-configuration-to-generate-openapi-documents" class="hash-link" aria-label="Direct link to 1. Write Buf configuration to generate OpenAPI documents" title="Direct link to 1. Write Buf configuration to generate OpenAPI documents">​</a></h3><p>If you are careful, you must have discovered that there is a <code>buf.openapi.gen.yaml</code> configuration file under <code>api/admin/service/v1</code>. What configuration file is this? I will put the configuration file out now:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">managed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">plugins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   generate openapi v3 yaml doc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> openapi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">out</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./app/admin/service/cmd/server/assets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">opt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> naming=json </span><span class="token comment" style="color:#999988;font-style:italic"># Naming convention. Use &quot;proto&quot; to pass the name directly from the proto file. Default: json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> depth=2 </span><span class="token comment" style="color:#999988;font-style:italic"># The recursion depth of the loop message, the default is: 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> default_response=false </span><span class="token comment" style="color:#999988;font-style:italic"># Add default response message. If &quot;true&quot;, automatically adds a default response for operations that use the google.rpc.Status message. Useful if you use envoy or grpc-gateway for transcoding as they use this type as the default error response. Default: true.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> enum_type=string </span><span class="token comment" style="color:#999988;font-style:italic"># The serialized type of the enumeration type. Use &quot;string&quot; to perform string-based serialization. Default: integer.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> output_mode=merged </span><span class="token comment" style="color:#999988;font-style:italic"># Output file generation mode. By default, only one openapi.yaml file will be generated in the output folder. Using &quot;source_relative&quot; will generate a separate &quot;[inputfile].openapi.yaml&quot; file for each &#x27;[inputfile].proto&#x27; file. Default: merged.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> fq_schema_naming=false </span><span class="token comment" style="color:#999988;font-style:italic"># Whether to add the package name to the Schema name. If it is true, the package name will be added, for example: system.service.v1.ListDictDetailResponse, otherwise: ListDictDetailResponse. Default: false.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This configuration file was written to generate OpenAPI v3 documentation.</p><p>So, how to use this configuration file? Still use the Buf generate command. This command still needs to be executed in the project root directory, but the <code>--template</code> parameter must be used to introduce the <code>buf.openapi.gen.yam</code> configuration file:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">buf generate --path api/admin/service/v1 --template api/admin/service/v1/buf.openapi.gen.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally, under the directory <code>./app/admin/service/cmd/assets</code>, a file named <code>openapi.yaml</code> will be generated.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-write-the-command-for-buf-to-gen-openapi-documents-into-makefile">2. Write the command for Buf to gen OpenAPI documents into Makefile<a href="#2-write-the-command-for-buf-to-gen-openapi-documents-into-makefile" class="hash-link" aria-label="Direct link to 2. Write the command for Buf to gen OpenAPI documents into Makefile" title="Direct link to 2. Write the command for Buf to gen OpenAPI documents into Makefile">​</a></h3><p>For such a long command, it is obviously more useful to write it into the <code>Makefile</code>.</p><p>So, we start writing the <code>Makefile</code>:</p><div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># generate protobuf api go code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token target symbol" style="color:#36acaa">api</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buf generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># generate OpenAPI v3 docs.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token target symbol" style="color:#36acaa">openapi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buf generate --path api/admin/service/v1 --template api/admin/service/v1/buf.openapi.gen.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buf generate --path api/front/service/v1 --template api/front/service/v1/buf.openapi.gen.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># run application</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token target symbol" style="color:#36acaa">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> api openapi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">@</span><span class="token plain">go run ./cmd/server -conf ./configs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this way, we only need to execute the <code>Make</code> command in the <code>backend</code> root directory to complete the generation of OpenAPI.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">make</span><span class="token plain"> openapi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-use-golangs-embedding-files-feature-to-embed-openapiyaml">3. Use Golang&#x27;s Embedding Files feature to embed openapi.yaml<a href="#3-use-golangs-embedding-files-feature-to-embed-openapiyaml" class="hash-link" aria-label="Direct link to 3. Use Golang&#x27;s Embedding Files feature to embed openapi.yaml" title="Direct link to 3. Use Golang&#x27;s Embedding Files feature to embed openapi.yaml">​</a></h3><p>OpenAPI documents are to be read using <code>Swagger UI</code> and provided to the front end, so <code>openapi.yaml</code> must follow the program. I initially thought about putting it in <code>configs</code>. Although it is a yaml file, it is still fundamentally different from the configuration file: it is a document, not a configuration.</p><p>Documentation, following the binary program, in my opinion, is the optimal solution. Next, we start to implement the embedding of documents.</p><p>Now we go to the directory <code>./app/admin/service/cmd/server/assets</code>, and we create a code file named <code>assets.go</code> under this directory.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> assets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;embed&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//go:embed openapi.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> OpenApiData </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Use the <code>go:embed</code> annotation to introduce the <code>openapi.yaml</code> document, and read it into a global variable of type <code>[]byte</code> named <code>OpenApiData</code>.</p><p>In this way, we embedded <code>openapi.yaml</code> file into the program.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-integrate-swagger-ui-into-the-project-and-read-the-embedded-openapiyaml-document">4. Integrate Swagger UI into the project and read the embedded openapi.yaml document<a href="#4-integrate-swagger-ui-into-the-project-and-read-the-embedded-openapiyaml-document" class="hash-link" aria-label="Direct link to 4. Integrate Swagger UI into the project and read the embedded openapi.yaml document" title="Direct link to 4. Integrate Swagger UI into the project and read the embedded openapi.yaml document">​</a></h3><p>Finally, we start integrating <code>Swagger UI</code></p><p>To integrate <code>Swagger UI</code>, I packed <code>Swagger UI</code> into a software package. To use it, we need to install the dependent library:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">go get github.com/devexps/go-swagger-ui</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, call the method in the package where the HTTP server is created:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    swaggerUI </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-swagger-ui&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-micro/v2/transport/http&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/devexps/go-monolithic-demo/app/admin/service/cmd/server/assets&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// NewHTTPServer new an HTTP server.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewHTTPServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Server </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    srv </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> bootstrap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">CreateHTTPServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    swaggerUI</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RegisterSwaggerUIServerWithOption</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        srv</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        swaggerUI</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithTitle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;GoMicro Monolithic demo&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        swaggerUI</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithMemoryData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">assets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OpenApiData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;yaml&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> srv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, we are done!</p><p>If the port of the service is 8080, then we can access the <code>Swagger UI</code> by accessing the following link: http://localhost:8080/docs/</p><p>At the same time, the <code>openapi.yaml</code> file can also be accessed online at: http://localhost:8080/docs/openapi.yaml</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>After you learn these knowledge points, you will find that the knowledge points involved in getting started using the GoMicro microservice framework are not complicated, and the threshold for learning is still very low. Base on the demo project in this article, I believe you can start writing projects quickly.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2><ul><li><a href="https://www.atlassian.com/microservices/microservices-architecture/microservices-vs-monolith" target="_blank" rel="noopener noreferrer">Microservices vs. monolithic architecture</a></li><li><a href="https://github.com/google/wire" target="_blank" rel="noopener noreferrer">Wire</a></li><li><a href="https://protobuf.dev/" target="_blank" rel="noopener noreferrer">Protocol Buffers</a></li><li><a href="https://grpc.io/" target="_blank" rel="noopener noreferrer">gRPC</a></li><li><a href="https://grpc-ecosystem.github.io/grpc-gateway/" target="_blank" rel="noopener noreferrer">gRPC-Gateway</a></li><li><a href="https://entgo.io/" target="_blank" rel="noopener noreferrer">Entgo</a></li><li><a href="https://buf.build/" target="_blank" rel="noopener noreferrer">Buf</a></li><li><a href="https://makefiletutorial.com/" target="_blank" rel="noopener noreferrer">Makefile</a></li><li><a href="https://swagger.io/specification/" target="_blank" rel="noopener noreferrer">OpenAPI</a></li></ul></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/go-micro/">go-micro</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/microservice/">microservice</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/framework/">framework</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/swagger/">swagger</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/monolithic/">monolithic</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/architecture/">architecture</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/practice/">practice</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/2023/11/17/go-micro-integrates-and-uses-swagger-ui/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Golang microservice framework (Go-Micro) easily integrates and uses Swagger UI</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#why-should-we-learn-to-use-the-microservice-framework" class="table-of-contents__link toc-highlight">Why should we learn to use the microservice framework?</a></li><li><a href="#demo-code-repository" class="table-of-contents__link toc-highlight">Demo code repository</a></li><li><a href="#project-structure" class="table-of-contents__link toc-highlight">Project structure</a></li><li><a href="#prerequisite-knowledge" class="table-of-contents__link toc-highlight">Prerequisite knowledge</a></li><li><a href="#installation-environment" class="table-of-contents__link toc-highlight">Installation environment</a><ul><li><a href="#install-make" class="table-of-contents__link toc-highlight">Install Make</a></li><li><a href="#protoc-installation" class="table-of-contents__link toc-highlight">Protoc installation</a></li><li><a href="#golang-install-tools" class="table-of-contents__link toc-highlight">Golang install tools</a></li><li><a href="#install-ide-plug-in" class="table-of-contents__link toc-highlight">Install IDE plug-in</a></li></ul></li><li><a href="#use-of-wire" class="table-of-contents__link toc-highlight">Use of Wire</a><ul><li><a href="#wirego" class="table-of-contents__link toc-highlight">wire.go</a></li><li><a href="#wire_gengo" class="table-of-contents__link toc-highlight">wire_gen.go</a></li><li><a href="#code-generation" class="table-of-contents__link toc-highlight">Code generation</a></li></ul></li><li><a href="#use-of-buf" class="table-of-contents__link toc-highlight">Use of Buf</a><ul><li><a href="#bufworkyaml" class="table-of-contents__link toc-highlight">buf.work.yaml</a></li><li><a href="#bufgenyaml" class="table-of-contents__link toc-highlight">buf.gen.yaml</a></li><li><a href="#bufyaml" class="table-of-contents__link toc-highlight">buf.yaml</a></li><li><a href="#api-code-generation" class="table-of-contents__link toc-highlight">API code generation</a></li></ul></li><li><a href="#use-of-ent" class="table-of-contents__link toc-highlight">Use of Ent</a><ul><li><a href="#schema" class="table-of-contents__link toc-highlight">Schema</a></li><li><a href="#create-a-schema" class="table-of-contents__link toc-highlight">Create a Schema</a></li><li><a href="#mixin-reuse-fields" class="table-of-contents__link toc-highlight">Mixin reuse fields</a></li><li><a href="#generate-ent-code" class="table-of-contents__link toc-highlight">Generate Ent code</a></li></ul></li><li><a href="#openapi-usages" class="table-of-contents__link toc-highlight">OpenAPI usages</a><ul><li><a href="#1-write-buf-configuration-to-generate-openapi-documents" class="table-of-contents__link toc-highlight">1. Write Buf configuration to generate OpenAPI documents</a></li><li><a href="#2-write-the-command-for-buf-to-gen-openapi-documents-into-makefile" class="table-of-contents__link toc-highlight">2. Write the command for Buf to gen OpenAPI documents into Makefile</a></li><li><a href="#3-use-golangs-embedding-files-feature-to-embed-openapiyaml" class="table-of-contents__link toc-highlight">3. Use Golang&#39;s Embedding Files feature to embed openapi.yaml</a></li><li><a href="#4-integrate-swagger-ui-into-the-project-and-read-the-embedded-openapiyaml-document" class="table-of-contents__link toc-highlight">4. Integrate Swagger UI into the project and read the embedded openapi.yaml document</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 • Designed and built by Devexps</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b7737520.js"></script>
<script src="/assets/js/main.615d3f2f.js"></script>
</body>
</html>